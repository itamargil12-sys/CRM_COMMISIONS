import React, { useState } from 'react';
import { Plus, Edit2, Trash2, DollarSign, Users, TrendingUp, Calendar, Download, Upload, Save, AlertCircle } from 'lucide-react';

const ProjectCRM = () => {
  const [projects, setProjects] = useState([
    {
      id: 1,
      clientName: "Gil Brown",
      projectType: "Labor only",
      price: 13798.00,
      costs: 4000.00,
      profit: 3519.20,
      status: "finished",
      createdAt: "2024-01-15T10:00:00Z"
    },
    {
      id: 2,
      clientName: "Bryn Mcniedry",
      projectType: "wall",
      price: 2400.00,
      costs: 800.00,
      profit: 560.00,
      status: "finished",
      createdAt: "2024-01-16T10:00:00Z"
    },
    {
      id: 3,
      clientName: "Shawn Sagullo",
      projectType: "fireplace",
      price: 5450.00,
      costs: 2500.00,
      profit: 930.00,
      status: "paid 10% - waiting for fireplace purchase",
      createdAt: "2024-01-17T10:00:00Z"
    },
    {
      id: 4,
      clientName: "Joyce Stacey",
      projectType: "concrete",
      price: 3325.00,
      costs: 1200.00,
      profit: 730.00,
      status: "finished",
      createdAt: "2024-01-18T10:00:00Z"
    },
    {
      id: 5,
      clientName: "Christopher Kempton",
      projectType: "concrete",
      price: 10650.00,
      costs: 3700.00,
      profit: 2410.00,
      status: "finished",
      createdAt: "2024-01-19T10:00:00Z"
    },
    {
      id: 6,
      clientName: "Dave Shrestha",
      projectType: "Deck",
      price: 23275.00,
      costs: 19000.00,
      profit: -190.00,
      status: "finished - didn't get money",
      createdAt: "2024-01-20T10:00:00Z"
    },
    {
      id: 7,
      clientName: "Thomas J Glas- Hochstettler",
      projectType: "Roof",
      price: 35229.90,
      costs: 18696.20,
      profit: 4793.86,
      status: "finished",
      createdAt: "2024-01-21T10:00:00Z"
    },
    {
      id: 8,
      clientName: "Deborah Butzen",
      projectType: "Deck replacement",
      price: 20581.00,
      costs: 8146.00,
      profit: 4159.40,
      status: "finished",
      createdAt: "2024-01-22T10:00:00Z"
    },
    {
      id: 9,
      clientName: "Barry Nielsen",
      projectType: "Railing Replacement",
      price: 17750.00,
      costs: 10524.00,
      profit: 1838.00,
      status: "finished",
      createdAt: "2024-01-23T10:00:00Z"
    },
    {
      id: 10,
      clientName: "Linda Wakefield",
      projectType: "windows replacement",
      price: 28440.00,
      costs: 8000.00,
      profit: 7376.00,
      status: "finished",
      createdAt: "2024-01-24T10:00:00Z"
    },
    {
      id: 11,
      clientName: "Ron Rucker",
      projectType: "roof replacement",
      price: 27698.00,
      costs: 15574.00,
      profit: 3292.20,
      status: "finished",
      createdAt: "2024-01-25T10:00:00Z"
    },
    {
      id: 12,
      clientName: "Jeffrey Kirsch",
      projectType: "roof cleaning",
      price: 1250.00,
      costs: 550.00,
      profit: 225.00,
      status: "finished",
      createdAt: "2024-01-26T10:00:00Z"
    },
    {
      id: 13,
      clientName: "Sheryl Still",
      projectType: "Patio Cover",
      price: 17960.00,
      costs: 7640.00,
      profit: 3364.00,
      status: "finished",
      createdAt: "2024-01-27T10:00:00Z"
    },
    {
      id: 14,
      clientName: "Barry Nielsen",
      projectType: "Painting",
      price: 17250.00,
      costs: 8881.00,
      profit: 2465.00,
      status: "finished",
      createdAt: "2024-01-28T10:00:00Z"
    },
    {
      id: 15,
      clientName: "Raymond Winkler",
      projectType: "TPO + Trex",
      price: 35360.00,
      costs: 13821.00,
      profit: 7233.50,
      status: "finished - need to talk with Tzvi",
      createdAt: "2024-01-29T10:00:00Z"
    },
    {
      id: 16,
      clientName: "Michael Dodds",
      projectType: "Siding replacement",
      price: 8000.00,
      costs: 4000.00,
      profit: 1200.00,
      status: "finished",
      createdAt: "2024-01-30T10:00:00Z"
    },
    {
      id: 17,
      clientName: "Sandra Behrens",
      projectType: "roof replacement",
      price: 28898.00,
      costs: 15306.00,
      profit: 3906.20,
      status: "finished",
      createdAt: "2024-01-31T10:00:00Z"
    },
    {
      id: 18,
      clientName: "Kevin Mcnally",
      projectType: "flooring replacement",
      price: 5100.00,
      costs: 1500.00,
      profit: 1290.00,
      status: "finished",
      createdAt: "2024-02-01T10:00:00Z"
    },
    {
      id: 19,
      clientName: "Linda Wakefield",
      projectType: "windows replacement (Brick wall)",
      price: 10520.00,
      costs: 4000.00,
      profit: 2208.00,
      status: "finished",
      createdAt: "2024-02-02T10:00:00Z"
    },
    {
      id: 20,
      clientName: "Fred Keitha",
      projectType: "concrete",
      price: 9870.00,
      costs: 4002.00,
      profit: 1947.00,
      status: "finished",
      createdAt: "2024-02-03T10:00:00Z"
    },
    {
      id: 21,
      clientName: "Scott Slater",
      projectType: "concrete",
      price: 10350.00,
      costs: 4500.00,
      profit: 1890.00,
      status: "concrete done",
      createdAt: "2024-02-04T10:00:00Z"
    },
    {
      id: 22,
      clientName: "Troy Kirkland",
      projectType: "Siding replacement",
      price: 22566.00,
      costs: 11642.00,
      profit: 3205.40,
      status: "finished",
      createdAt: "2024-02-05T10:00:00Z"
    },
    {
      id: 23,
      clientName: "Deborah Ramsey",
      projectType: "bathroom remodel",
      price: 21195.00,
      costs: 10576.00,
      profit: 3190.00,
      status: "finished",
      createdAt: "2024-02-06T10:00:00Z"
    },
    {
      id: 24,
      clientName: "Mathew Patrick",
      projectType: "roof replacement",
      price: 30505.00,
      costs: 13000.00,
      profit: 5702.00,
      status: "need to get money",
      createdAt: "2024-02-07T10:00:00Z"
    },
    {
      id: 25,
      clientName: "Thomas Peterson",
      projectType: "Painting",
      price: 23438.00,
      costs: 7900.00,
      profit: 5425.20,
      status: "finished",
      createdAt: "2024-02-08T10:00:00Z"
    },
    {
      id: 26,
      clientName: "David Jones",
      projectType: "kitchen remodel",
      price: 47521.00,
      costs: 25000.00,
      profit: 6508.40,
      status: "punchlist",
      createdAt: "2024-02-09T10:00:00Z"
    },
    {
      id: 27,
      clientName: "Pamela Propes",
      projectType: "Roof replacement",
      price: 31068.00,
      costs: 15000.00,
      profit: 4927.20,
      status: "roof done",
      createdAt: "2024-02-10T10:00:00Z"
    },
    {
      id: 28,
      clientName: "Raymond Winkler",
      projectType: "Roof repair",
      price: 2400.00,
      costs: 700.00,
      profit: 610.00,
      status: "finished",
      createdAt: "2024-02-11T10:00:00Z"
    },
    {
      id: 29,
      clientName: "Martin Callaghan",
      projectType: "Sand & Stain",
      price: 9675.00,
      costs: 5500.00,
      profit: 1330.00,
      status: "finished",
      createdAt: "2024-02-12T10:00:00Z"
    },
    {
      id: 30,
      clientName: "Carol Dodge",
      projectType: "Asphalt",
      price: 11108.00,
      costs: 5000.00,
      profit: 1943.20,
      status: "finished",
      createdAt: "2024-02-13T10:00:00Z"
    },
    {
      id: 31,
      clientName: "Crea Williams",
      projectType: "Railing",
      price: 17520.00,
      costs: 5000.00,
      profit: 4508.00,
      status: "finished",
      createdAt: "2024-02-14T10:00:00Z"
    },
    {
      id: 32,
      clientName: "Robben Romano",
      projectType: "Few projects",
      price: 20720.00,
      costs: 10000.00,
      profit: 3288.00,
      status: "asphalt job done",
      createdAt: "2024-02-15T10:00:00Z"
    },
    {
      id: 33,
      clientName: "Kathie Blackburn",
      projectType: "Painting",
      price: 18270.00,
      costs: 8000.00,
      profit: 3308.00,
      status: "3 payments made",
      createdAt: "2024-02-16T10:00:00Z"
    },
    {
      id: 34,
      clientName: "Michael Dodds",
      projectType: "Painting",
      price: 2510.00,
      costs: 1200.00,
      profit: 508.00,
      status: "finished",
      createdAt: "2024-02-17T10:00:00Z"
    },
    {
      id: 35,
      clientName: "Christine Carranza",
      projectType: "Deck",
      price: 46119.00,
      costs: 35000.00,
      profit: 947.60,
      status: "landscaping done",
      createdAt: "2024-02-18T10:00:00Z"
    },
    {
      id: 36,
      clientName: "Lawrence Narayan",
      projectType: "Plans",
      price: 18000.00,
      costs: 8000.00,
      profit: 3200.00,
      status: "Rachel appointment done",
      createdAt: "2024-02-19T10:00:00Z"
    },
    {
      id: 37,
      clientName: "Barry Nielson",
      projectType: "Painting",
      price: 4500.00,
      costs: 1600.00,
      profit: 1000.00,
      status: "finished",
      createdAt: "2024-02-20T10:00:00Z"
    },
    {
      id: 38,
      clientName: "Barry Nielson",
      projectType: "Floor+electric+landscaping",
      price: 16100.00,
      costs: 6000.00,
      profit: 3440.00,
      status: "landscaping done",
      createdAt: "2024-02-21T10:00:00Z"
    },
    {
      id: 39,
      clientName: "Crea Williams",
      projectType: "Deck",
      price: 7100.00,
      costs: 3000.00,
      profit: 1340.00,
      status: "finished",
      createdAt: "2024-02-22T10:00:00Z"
    },
    {
      id: 40,
      clientName: "Pak Chan",
      projectType: "Metal roof",
      price: 62123.00,
      costs: 25000.00,
      profit: 12349.20,
      status: "need to pay down payment",
      createdAt: "2024-02-23T10:00:00Z"
    },
    {
      id: 41,
      clientName: "Patricia Mcrea",
      projectType: "deck repair",
      price: 4700.00,
      costs: 1200.00,
      profit: 1280.00,
      status: "need to order materials",
      createdAt: "2024-02-24T10:00:00Z"
    },
    {
      id: 42,
      clientName: "Melanie Raines (ELM)",
      projectType: "porch repair",
      price: 6250.00,
      costs: 2500.00,
      profit: 1250.00,
      status: "can start",
      createdAt: "2024-02-25T10:00:00Z"
    }
  ]);
  const [showForm, setShowForm] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [formData, setFormData] = useState({
    clientName: '',
    projectType: '',
    price: '',
    costs: '',
    profit: '',
    status: 'can start'
  });

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => {
      const updated = { ...prev, [name]: value };
      
      // Auto-calculate profit when price or costs change
      if (name === 'price' || name === 'costs') {
        const price = parseFloat(updated.price) || 0;
        const costs = parseFloat(updated.costs) || 0;
        updated.profit = (price - costs).toFixed(2);
      }
      
      return updated;
    });
  };

  const handleSubmit = () => {
    if (!formData.clientName || !formData.projectType || !formData.price || !formData.costs) {
      alert('Please fill in all required fields');
      return;
    }
    
    const project = {
      id: editingId || Date.now(),
      ...formData,
      price: parseFloat(formData.price) || 0,
      costs: parseFloat(formData.costs) || 0,
      profit: parseFloat(formData.profit) || 0,
      createdAt: editingId ? projects.find(p => p.id === editingId)?.createdAt : new Date().toISOString()
    };

    if (editingId) {
      setProjects(prev => prev.map(p => p.id === editingId ? project : p));
    } else {
      setProjects(prev => [...prev, project]);
    }

    resetForm();
  };

  const resetForm = () => {
    setFormData({
      clientName: '',
      projectType: '',
      price: '',
      costs: '',
      profit: '',
      status: 'can start'
    });
    setShowForm(false);
    setEditingId(null);
  };

  const handleEdit = (project) => {
    setFormData({
      clientName: project.clientName,
      projectType: project.projectType,
      price: project.price.toString(),
      costs: project.costs.toString(),
      profit: project.profit.toString(),
      status: project.status
    });
    setEditingId(project.id);
    setShowForm(true);
  };

  const handleDelete = (id) => {
    setProjects(prev => prev.filter(p => p.id !== id));
  };

  const exportData = () => {
    if (projects.length === 0) {
      alert('אין נתונים לייצוא. הוסף פרויקטים קודם.');
      return;
    }
    
    try {
      const dataStr = JSON.stringify(projects, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `project-data-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      alert('הקובץ ירד בהצלחה לתיקיית ההורדות!');
    } catch (error) {
      alert('שגיאה בייצוא הנתונים. נסה שוב.');
      console.error('Export error:', error);
    }
  };

  const importData = (event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const importedData = JSON.parse(e.target.result);
          if (Array.isArray(importedData)) {
            setProjects(importedData);
            alert('Data imported successfully!');
          } else {
            alert('Invalid file format. Please select a valid project data file.');
          }
        } catch (error) {
          alert('Error reading file. Please make sure it\'s a valid JSON file.');
        }
      };
      reader.readAsText(file);
    }
    event.target.value = '';
  };

  const copyDataToClipboard = async () => {
    if (projects.length === 0) {
      alert('אין נתונים להעתקה. הוסף פרויקטים קודם.');
      return;
    }
    
    // Create a readable format for copying
    let readableData = "נתוני הפרויקטים שלך:\n\n";
    projects.forEach((project, index) => {
      readableData += `פרויקט ${index + 1}:\n`;
      readableData += `לקוח: ${project.clientName}\n`;
      readableData += `סוג פרויקט: ${project.projectType}\n`;
      readableData += `מחיר: ${project.price.toLocaleString()}\n`;
      readableData += `עלויות: ${project.costs.toLocaleString()}\n`;
      readableData += `רווח: ${project.profit.toLocaleString()}\n`;
      readableData += `סטטוס: ${project.status}\n`;
      readableData += "-------------------\n";
    });
    
    readableData += `\nסיכום:\n`;
    readableData += `סה"כ הכנסות: ${projects.reduce((sum, p) => sum + p.price, 0).toLocaleString()}\n`;
    readableData += `סה"כ עלויות: ${projects.reduce((sum, p) => sum + p.costs, 0).toLocaleString()}\n`;
    readableData += `סה"כ רווח: ${projects.reduce((sum, p) => sum + p.profit, 0).toLocaleString()}\n`;
    
    try {
      await navigator.clipboard.writeText(readableData);
      alert('הנתונים הועתקו ללוח! אפשר להדביק ב-Google Docs או בכל מקום אחר.');
    } catch (err) {
      // Fallback for browsers that don't support clipboard API
      const textArea = document.createElement('textarea');
      textArea.value = readableData;
      textArea.style.position = 'fixed';
      textArea.style.left = '-9999px';
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      alert('הנתונים הועתקו ללוח! אפשר להדביק ב-Google Docs או בכל מקום אחר.');
    }
  };

  // Calculate totals - only count projects marked as finished
  const totalRevenue = projects.reduce((sum, p) => sum + p.price, 0);
  const totalCosts = projects.reduce((sum, p) => sum + p.costs, 0);
  const totalProfit = projects.reduce((sum, p) => sum + p.profit, 0);
  
  // Only count as "finished" if status contains "finished" or "finish"
  const finishedProjects = projects.filter(p => 
    p.status.toLowerCase().includes('finished') || 
    p.status.toLowerCase().includes('finish')
  ).length;
  
  // Calculate finished project totals for dashboard
  const finishedProjectsData = projects.filter(p => 
    p.status.toLowerCase().includes('finished') || 
    p.status.toLowerCase().includes('finish')
  );
  const finishedRevenue = finishedProjectsData.reduce((sum, p) => sum + p.price, 0);
  const finishedProfit = finishedProjectsData.reduce((sum, p) => sum + p.profit, 0);
  
  const inProgressProjects = projects.filter(p => 
    !p.status.toLowerCase().includes('finished') && 
    !p.status.toLowerCase().includes('finish')
  ).length;

  const getStatusColor = (status) => {
    const statusLower = status.toLowerCase();
    
    // Finished projects - Green (only if contains "finished" or "finish")
    if (statusLower.includes('finished') || statusLower.includes('finish')) {
      return 'bg-green-100 text-green-800 border border-green-300';
    }
    
    // Payment received - Blue
    if (statusLower.includes('paid') && !statusLower.includes('need')) {
      return 'bg-blue-100 text-blue-800';
    }
    
    // Money/Collection issues - Red
    if (statusLower.includes("didn't get") || statusLower.includes('need to get money') || statusLower.includes('collection')) {
      return 'bg-red-100 text-red-800';
    }
    
    // Waiting/Need to do something - Orange
    if (statusLower.includes('waiting') || statusLower.includes('need to') || statusLower.includes('order')) {
      return 'bg-orange-100 text-orange-800';
    }
    
    // Ready to start - Yellow
    if (statusLower.includes('can start') || statusLower.includes('ready')) {
      return 'bg-yellow-100 text-yellow-800';
    }
    
    // Work in progress - Purple
    if (statusLower.includes('punchlist') || statusLower.includes('talk with') || statusLower.includes('appointment') || statusLower.includes('done') && !statusLower.includes('finished')) {
      return 'bg-purple-100 text-purple-800';
    }
    
    // Partial payments - Indigo
    if (statusLower.includes('payments made') || (statusLower.includes('%') && statusLower.includes('paid'))) {
      return 'bg-indigo-100 text-indigo-800';
    }
    
    // Default for custom statuses
    return 'bg-gray-100 text-gray-800';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-100 p-4">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="mb-8">
          <h1 className="text-4xl font-bold text-gray-800 mb-2">Project Management CRM</h1>
          <p className="text-gray-600">Track your construction projects, costs, and profits</p>
        </div>

        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Total Revenue</p>
                <p className="text-xl font-bold text-gray-800">${totalRevenue.toLocaleString()}</p>
                <p className="text-xs text-gray-500">All Projects</p>
              </div>
              <DollarSign className="h-10 w-10 text-green-500" />
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Finished Revenue</p>
                <p className="text-xl font-bold text-gray-800">${finishedRevenue.toLocaleString()}</p>
                <p className="text-xs text-gray-500">Completed Projects Only</p>
              </div>
              <TrendingUp className="h-10 w-10 text-blue-500" />
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Finished Profit</p>
                <p className="text-xl font-bold text-gray-800">${finishedProfit.toLocaleString()}</p>
                <p className="text-xs text-gray-500">From Completed Projects</p>
              </div>
              <AlertCircle className="h-10 w-10 text-purple-500" />
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-600">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Finished Projects</p>
                <p className="text-xl font-bold text-gray-800">{finishedProjects}</p>
                <p className="text-xs text-gray-500">Contains "finished" in status</p>
              </div>
              <Calendar className="h-10 w-10 text-green-600" />
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Active Projects</p>
                <p className="text-xl font-bold text-gray-800">{inProgressProjects}</p>
                <p className="text-xs text-gray-500">All other statuses</p>
              </div>
              <Users className="h-10 w-10 text-orange-500" />
            </div>
          </div>
        </div>

        {/* Action Buttons */}
        <div className="mb-6 flex flex-wrap gap-4">
          <button
            onClick={() => setShowForm(!showForm)}
            className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg shadow-lg transition-all duration-200 flex items-center space-x-2 font-medium"
          >
            <Plus className="h-5 w-5" />
            <span>{showForm ? 'Cancel' : 'Add Project'}</span>
          </button>

          <button
            onClick={exportData}
            className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg shadow-lg transition-all duration-200 flex items-center space-x-2 font-medium"
            disabled={projects.length === 0}
          >
            <Download className="h-5 w-5" />
            <span>Export Data</span>
          </button>

          <label className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg shadow-lg transition-all duration-200 flex items-center space-x-2 font-medium cursor-pointer">
            <Upload className="h-5 w-5" />
            <span>Import Data</span>
            <input
              type="file"
              accept=".json"
              onChange={importData}
              className="hidden"
            />
          </label>

          <button
            onClick={copyDataToClipboard}
            className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg shadow-lg transition-all duration-200 flex items-center space-x-2 font-medium"
            disabled={projects.length === 0}
          >
            <Save className="h-5 w-5" />
            <span>Copy Data</span>
          </button>
        </div>

        {/* Form */}
        {showForm && (
          <div className="bg-white rounded-xl shadow-xl p-6 mb-8">
            <h2 className="text-2xl font-semibold text-gray-800 mb-6">
              {editingId ? 'Edit Project' : 'Add New Project'}
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Client Name</label>
                <input
                  type="text"
                  name="clientName"
                  value={formData.clientName}
                  onChange={handleInputChange}
                  placeholder="e.g., Taylor Marrow III"
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Type of Project</label>
                <input
                  type="text"
                  name="projectType"
                  value={formData.projectType}
                  onChange={handleInputChange}
                  placeholder="e.g., deck replacement, roof repair"
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Project Price ($)</label>
                <input
                  type="number"
                  name="price"
                  value={formData.price}
                  onChange={handleInputChange}
                  step="0.01"
                  placeholder="14200.00"
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Our Costs ($)</label>
                <input
                  type="number"
                  name="costs"
                  value={formData.costs}
                  onChange={handleInputChange}
                  step="0.01"
                  placeholder="3915.00"
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Profit ($)</label>
                <input
                  type="number"
                  name="profit"
                  value={formData.profit}
                  onChange={handleInputChange}
                  step="0.01"
                  className="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                  readOnly
                />
                <p className="text-xs text-gray-500 mt-1">Auto-calculated: Price - Costs</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
                <input
                  type="text"
                  name="status"
                  value={formData.status}
                  onChange={handleInputChange}
                  placeholder="e.g., finished, need to get money, can start"
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                />
                <p className="text-xs text-gray-500 mt-1">כתוב סטטוס חופשי - הצבע יתעדכן אוטומטית</p>
              </div>

              <div className="md:col-span-2 lg:col-span-3">
                <button
                  type="button"
                  onClick={handleSubmit}
                  className="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg shadow-lg transition-all duration-200 font-medium"
                >
                  {editingId ? 'Update Project' : 'Add Project'}
                </button>
                <button
                  type="button"
                  onClick={resetForm}
                  className="ml-4 bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg shadow-lg transition-all duration-200 font-medium"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Project List */}
        <div className="bg-white rounded-xl shadow-xl overflow-hidden">
          <div className="p-6 border-b border-gray-200">
            <h2 className="text-2xl font-semibold text-gray-800">Project Records</h2>
          </div>
          
          {projects.length === 0 ? (
            <div className="p-12 text-center">
              <DollarSign className="h-16 w-16 text-gray-300 mx-auto mb-4" />
              <p className="text-gray-500 text-lg">No projects recorded yet</p>
              <p className="text-gray-400">Click "Add Project" to get started</p>
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-4 text-left text-sm font-medium text-gray-500">Client Name</th>
                    <th className="px-6 py-4 text-left text-sm font-medium text-gray-500">Type of Project</th>
                    <th className="px-6 py-4 text-left text-sm font-medium text-gray-500">Price</th>
                    <th className="px-6 py-4 text-left text-sm font-medium text-gray-500">Our Costs</th>
                    <th className="px-6 py-4 text-left text-sm font-medium text-gray-500">Profit</th>
                    <th className="px-6 py-4 text-left text-sm font-medium text-gray-500">Status</th>
                    <th className="px-6 py-4 text-left text-sm font-medium text-gray-500">Actions</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {projects.map((project) => (
                    <tr key={project.id} className="hover:bg-gray-50">
                      <td className="px-6 py-4 text-sm font-medium text-gray-900">{project.clientName}</td>
                      <td className="px-6 py-4 text-sm text-gray-700">{project.projectType}</td>
                      <td className="px-6 py-4 text-sm font-semibold text-gray-700">${project.price.toLocaleString()}</td>
                      <td className="px-6 py-4 text-sm text-red-600">${project.costs.toLocaleString()}</td>
                      <td className="px-6 py-4 text-sm font-semibold text-green-600">${project.profit.toLocaleString()}</td>
                      <td className="px-6 py-4">
                        <span className={`inline-flex px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(project.status)}`}>
                          {project.status.charAt(0).toUpperCase() + project.status.slice(1)}
                        </span>
                      </td>
                      <td className="px-6 py-4 text-sm">
                        <div className="flex space-x-2">
                          <button
                            onClick={() => handleEdit(project)}
                            className="text-indigo-600 hover:text-indigo-800 transition-colors duration-200"
                          >
                            <Edit2 className="h-4 w-4" />
                          </button>
                          <button
                            onClick={() => handleDelete(project.id)}
                            className="text-red-600 hover:text-red-800 transition-colors duration-200"
                          >
                            <Trash2 className="h-4 w-4" />
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default ProjectCRM;
